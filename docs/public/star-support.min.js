var StarSupport=function(){"use strict";class t{constructor(t={}){this.container=null,this.chatContainer=null,this.messages=[],this.isOpen=!1,this.isLoading=!1,this.conversationId="",this.config={apiEndpoint:"/api/star-support/chat",welcomeMessage:"Hi! How can I help you with the documentation today?",botName:"Docs Assistant",topicContext:"documentation",primaryColor:"#0066cc",backgroundColor:"#ffffff",textColor:"#333333",position:"bottom-right",suggestedQuestions:["How do I manage volunteers?","How do shift signups work?","What are the admin permissions?","How do I view reports?"],...t},this.conversationId=this.generateId(),this.init()}generateId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}init(){"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.createWidget()):this.createWidget())}createWidget(){this.container=document.createElement("div"),this.container.id="star-support-widget",this.container.className=`star-support-container ${this.config.position}`,this.addStyles(),this.container.innerHTML=`\n      <div class="star-support-toggle" data-testid="star-support-toggle">\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"></path>\n        </svg>\n      </div>\n      \n      <div class="star-support-chat" data-testid="star-support-chat" style="display: none;">\n        <div class="star-support-header">\n          <div class="star-support-title">\n            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>\n            </svg>\n            ${this.config.botName}\n          </div>\n          <button class="star-support-close" data-testid="star-support-close" aria-label="Close chat">\n            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <line x1="18" y1="6" x2="6" y2="18"></line>\n              <line x1="6" y1="6" x2="18" y2="18"></line>\n            </svg>\n          </button>\n        </div>\n        \n        <div class="star-support-messages" data-testid="star-support-messages">\n          <div class="star-support-message assistant">\n            <div class="star-support-message-content">${this.config.welcomeMessage}</div>\n          </div>\n          ${this.createSuggestedQuestions()}\n        </div>\n        \n        <div class="star-support-input-area">\n          <div class="star-support-input-container">\n            <input \n              type="text" \n              class="star-support-input" \n              data-testid="star-support-input"\n              placeholder="Ask a question..." \n              maxlength="500"\n            >\n            <button class="star-support-send" data-testid="star-support-send" aria-label="Send message">\n              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <line x1="22" y1="2" x2="11" y2="13"></line>\n                <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n    `,this.setupEventListeners(),document.body.appendChild(this.container),this.chatContainer=this.container.querySelector(".star-support-chat")}createSuggestedQuestions(){if(!this.config.suggestedQuestions||0===this.config.suggestedQuestions.length)return"";return`<div class="star-support-suggestions">${this.config.suggestedQuestions.map(t=>`<button class="star-support-suggestion" data-question="${this.escapeHtml(t)}">${this.escapeHtml(t)}</button>`).join("")}</div>`}escapeHtml(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}setupEventListeners(){if(!this.container)return;const t=this.container.querySelector(".star-support-toggle");t?.addEventListener("click",()=>this.toggleChat());const n=this.container.querySelector(".star-support-close");n?.addEventListener("click",()=>this.closeChat());const e=this.container.querySelector(".star-support-input"),s=this.container.querySelector(".star-support-send");e?.addEventListener("keypress",t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),this.sendMessage(e.value.trim()))}),s?.addEventListener("click",()=>{const t=e?.value?.trim();t&&this.sendMessage(t)}),this.container.addEventListener("click",t=>{const n=t.target;if(n.classList.contains("star-support-suggestion")){const t=n.getAttribute("data-question");t&&this.sendMessage(t)}})}addStyles(){const t="star-support-styles";if(document.getElementById(t))return;const n=document.createElement("style");n.id=t,n.textContent=`\n      .star-support-container {\n        position: fixed;\n        z-index: 10000;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        line-height: 1.4;\n      }\n\n      .star-support-container.bottom-right {\n        bottom: 20px;\n        right: 20px;\n      }\n\n      .star-support-container.bottom-left {\n        bottom: 20px;\n        left: 20px;\n      }\n\n      .star-support-toggle {\n        width: 60px;\n        height: 60px;\n        background: ${this.config.primaryColor};\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        transition: transform 0.2s, box-shadow 0.2s;\n        color: white;\n      }\n\n      .star-support-toggle:hover {\n        transform: scale(1.1);\n        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);\n      }\n\n      .star-support-chat {\n        position: absolute;\n        bottom: 80px;\n        right: 0;\n        width: 380px;\n        max-width: calc(100vw - 40px);\n        height: 500px;\n        max-height: calc(100vh - 120px);\n        background: ${this.config.backgroundColor};\n        border-radius: 12px;\n        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n      }\n\n      .star-support-container.bottom-left .star-support-chat {\n        left: 0;\n        right: auto;\n      }\n\n      .star-support-header {\n        background: ${this.config.primaryColor};\n        color: white;\n        padding: 16px 20px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n      }\n\n      .star-support-title {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-weight: 600;\n      }\n\n      .star-support-close {\n        background: none;\n        border: none;\n        color: white;\n        cursor: pointer;\n        padding: 4px;\n        border-radius: 4px;\n        opacity: 0.8;\n        transition: opacity 0.2s;\n      }\n\n      .star-support-close:hover {\n        opacity: 1;\n        background: rgba(255, 255, 255, 0.1);\n      }\n\n      .star-support-messages {\n        flex: 1;\n        overflow-y: auto;\n        padding: 20px;\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n      }\n\n      .star-support-message {\n        max-width: 80%;\n        word-wrap: break-word;\n      }\n\n      .star-support-message.user {\n        align-self: flex-end;\n      }\n\n      .star-support-message.assistant {\n        align-self: flex-start;\n      }\n\n      .star-support-message-content {\n        padding: 12px 16px;\n        border-radius: 18px;\n        background: #f5f5f5;\n        color: ${this.config.textColor};\n      }\n\n      .star-support-message.user .star-support-message-content {\n        background: ${this.config.primaryColor};\n        color: white;\n      }\n\n      .star-support-suggestions {\n        display: flex;\n        flex-direction: column;\n        gap: 8px;\n        margin-top: 12px;\n      }\n\n      .star-support-suggestion {\n        background: transparent;\n        border: 1px solid #e0e0e0;\n        border-radius: 8px;\n        padding: 8px 12px;\n        text-align: left;\n        cursor: pointer;\n        transition: all 0.2s;\n        font-size: 13px;\n        color: ${this.config.textColor};\n      }\n\n      .star-support-suggestion:hover {\n        border-color: ${this.config.primaryColor};\n        background: rgba(0, 102, 204, 0.05);\n      }\n\n      .star-support-input-area {\n        border-top: 1px solid #e0e0e0;\n        padding: 16px 20px;\n      }\n\n      .star-support-input-container {\n        display: flex;\n        gap: 8px;\n        align-items: flex-end;\n      }\n\n      .star-support-input {\n        flex: 1;\n        border: 1px solid #e0e0e0;\n        border-radius: 20px;\n        padding: 10px 16px;\n        font-size: 14px;\n        outline: none;\n        resize: none;\n        max-height: 80px;\n      }\n\n      .star-support-input:focus {\n        border-color: ${this.config.primaryColor};\n      }\n\n      .star-support-send {\n        background: ${this.config.primaryColor};\n        border: none;\n        border-radius: 50%;\n        width: 40px;\n        height: 40px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        color: white;\n        transition: opacity 0.2s;\n      }\n\n      .star-support-send:hover {\n        opacity: 0.9;\n      }\n\n      .star-support-send:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n\n      .star-support-sources {\n        margin-top: 8px;\n        font-size: 12px;\n        color: #666;\n      }\n\n      .star-support-source {\n        display: inline-block;\n        background: #f0f0f0;\n        padding: 2px 6px;\n        border-radius: 4px;\n        margin: 2px 4px 2px 0;\n        text-decoration: none;\n        color: ${this.config.primaryColor};\n      }\n\n      .star-support-source:hover {\n        background: #e0e0e0;\n      }\n\n      .star-support-loading {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 13px;\n        color: #666;\n        font-style: italic;\n      }\n\n      .star-support-loader {\n        width: 16px;\n        height: 16px;\n        border: 2px solid #f3f3f3;\n        border-top: 2px solid ${this.config.primaryColor};\n        border-radius: 50%;\n        animation: star-support-spin 1s linear infinite;\n      }\n\n      @keyframes star-support-spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n\n      @media (max-width: 480px) {\n        .star-support-chat {\n          width: calc(100vw - 40px);\n          height: calc(100vh - 120px);\n          bottom: 80px;\n          left: 20px !important;\n          right: 20px !important;\n        }\n      }\n    `,document.head.appendChild(n)}toggleChat(){this.isOpen?this.closeChat():this.openChat()}openChat(){if(!this.chatContainer)return;this.chatContainer.style.display="flex",this.isOpen=!0;const t=this.chatContainer.querySelector(".star-support-input");setTimeout(()=>t?.focus(),100)}closeChat(){this.chatContainer&&(this.chatContainer.style.display="none",this.isOpen=!1)}async sendMessage(t){if(!t.trim()||this.isLoading)return;const n=this.container?.querySelector(".star-support-input");n&&(n.value=""),this.addMessage({role:"user",content:t,timestamp:Date.now()});const e=this.container?.querySelector(".star-support-suggestions");e&&e.remove(),this.isLoading=!0,this.showLoading();try{const n=await this.callAPI(t);this.hideLoading(),n.message&&this.addMessage({role:"assistant",content:n.message,sources:n.sources,timestamp:Date.now()})}catch(t){this.hideLoading(),console.error("Chat error:",t),this.addMessage({role:"assistant",content:"Sorry, I encountered an error. Please try again.",timestamp:Date.now()})}this.isLoading=!1}async callAPI(t){const n=[...this.messages,{role:"user",content:t}],e={"Content-Type":"application/json","x-conversation-id":this.conversationId};this.config.authKey&&(e["x-auth-key"]=this.config.authKey);const s=await fetch(this.config.apiEndpoint,{method:"POST",headers:e,body:JSON.stringify({messages:n})});if(!s.ok)throw new Error(`HTTP ${s.status}`);return s.json()}addMessage(t){this.messages.push(t);const n=this.container?.querySelector(".star-support-messages");if(!n)return;const e=document.createElement("div");e.className=`star-support-message ${t.role}`;let s="";if(t.sources&&t.sources.length>0){s=`<div class="star-support-sources">Sources: ${t.sources.map(t=>`<a href="${t.url}" class="star-support-source" target="_blank" rel="noopener">${t.title}</a>`).join("")}</div>`}e.innerHTML=`\n      <div class="star-support-message-content">${this.escapeHtml(t.content)}</div>\n      ${s}\n    `,n.appendChild(e),n.scrollTop=n.scrollHeight}showLoading(){const t=this.container?.querySelector(".star-support-messages");if(!t)return;const n=document.createElement("div");n.className="star-support-message assistant",n.innerHTML='\n      <div class="star-support-message-content star-support-loading">\n        <div class="star-support-loader"></div>\n        Thinking...\n      </div>\n    ',t.appendChild(n),t.scrollTop=t.scrollHeight}hideLoading(){const t=this.container?.querySelector(".star-support-loading");t&&t.closest(".star-support-message")?.remove()}open(){this.openChat()}close(){this.closeChat()}destroy(){this.container?.remove();const t=document.getElementById("star-support-styles");t?.remove()}}class n extends HTMLElement{constructor(){super(...arguments),this.widget=null}connectedCallback(){const n={apiEndpoint:this.getAttribute("api-endpoint")||void 0,welcomeMessage:this.getAttribute("welcome-message")||void 0,botName:this.getAttribute("bot-name")||void 0,topicContext:this.getAttribute("topic-context")||void 0,primaryColor:this.getAttribute("primary-color")||void 0,backgroundColor:this.getAttribute("background-color")||void 0,textColor:this.getAttribute("text-color")||void 0,position:this.getAttribute("position")||void 0,authKey:this.getAttribute("auth-key")||void 0,suggestedQuestions:this.getAttribute("suggested-questions")?.split("|")||void 0};Object.keys(n).forEach(t=>{void 0===n[t]&&delete n[t]}),this.widget=new t(n)}disconnectedCallback(){this.widget?.destroy()}}return"undefined"==typeof window||customElements.get("star-support")||customElements.define("star-support",n),"undefined"!=typeof window&&(window.StarSupport=t),t}();
